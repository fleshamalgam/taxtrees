<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FEIS Editor</title>
  <style>
    body {
      background-color: #ffffff;
      color: #000000;
      margin: 0;
      font-family: "Courier New", Courier, monospace;
    }
    .toolbar {
      background-color: #336633;
      color: white;
      padding: 10px 15px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
    }
    button {
      font-family: monospace;
      font-size: 14px;
      padding: 6px 10px;
      cursor: pointer;
    }
    #editor {
      width: 100%;
      height: calc(100vh - 50px);
      padding: 20px;
      white-space: pre;
      overflow: auto;
      outline: none;
      font-family: "Courier New", Courier, monospace;
      line-height: 1.2;
    }
  </style>
</head>
<body>

  <div class="toolbar">
    FEIS Notepad Editor
    <button onclick="saveContent()">üíæ Save to Public Site</button>
  </div>

  <pre id="editor" contenteditable="true" spellcheck="false">
ABBREVIATION : 
EQUARV

SYNONYMS : 
Equisetum arvense var. alpestre Wahlenb.
E. a. var. boreale (Bong.) Rupr.
E. a. var. riparium Farw.
E. calderi Boivin
  </pre>

  <script>
    async function saveContent() {
      const content = document.getElementById("editor").innerText;
      const token = prompt("Enter your GitHub Personal Access Token:");

      if (!token) return alert("No token entered.");

      const repo = "fleshamalgam/taxtrees";
      const filePath = "index.html";
      const branch = "main";

      const apiUrl = `https://api.github.com/repos/${repo}/contents/${filePath}`;
      const headers = {
        "Authorization": `token ${token}`,
        "Accept": "application/vnd.github.v3+json"
      };

      try {
        const getRes = await fetch(apiUrl, { headers });
        const fileData = await getRes.json();
        const sha = fileData.sha;

        const newHtml = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset='UTF-8'>
  <title>FEIS Species Page</title>
  <style>
    body {
      background-color: #ffffff;
      color: #000000;
      margin: 0;
      font-family: "Courier New", Courier, monospace;
    }
    pre {
      white-space: pre;
      padding: 20px;
      font-family: "Courier New", Courier, monospace;
      line-height: 1.2;
    }
  </style>
</head>
<body>
<pre>
${content.replace(/</g, "&lt;").replace(/>/g, "&gt;")}
</pre>
</body>
</html>`;

        const response = await fetch(apiUrl, {
          method: "PUT",
          headers,
          body: JSON.stringify({
            message: "Update FEIS content",
            content: btoa(unescape(encodeURIComponent(newHtml))),
            sha: sha,
            branch: branch
          })
        });

        if (response.ok) {
          alert("‚úÖ Saved! View your site at:\nhttps://fleshamalgam.github.io/taxtrees/");
        } else {
          const err = await response.json();
          alert("‚ùå Save failed: " + (err.message || "Unknown error"));
          console.error(err);
        }
      } catch (err) {
        console.error(err);
        alert("‚ùå Failed to update file.");
      }
    }
  </script>

</body>
</html>
