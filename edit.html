<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Editable FEIS Page</title>
  <style>
    body {
      margin: 0;
      font-family: "Courier New", Courier, monospace;
      background-color: #ffffff;
      color: #000;
    }
    header {
      background-color: #336633;
      color: white;
      padding: 12px 20px;
      font-size: 20px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .container {
      display: flex;
    }
    nav {
      width: 220px;
      background-color: #eeeeee;
      padding: 15px;
      border-right: 1px solid #ccc;
      height: 100vh;
      box-sizing: border-box;
    }
    main {
      flex-grow: 1;
      padding: 20px;
    }
    .editor {
      font-family: "Courier New", Courier, monospace;
      white-space: pre-wrap;
      line-height: 1.1;
      min-height: 90vh;
      border: 1px solid #ccc;
      padding: 20px;
      outline: none;
    }
    button {
      font-family: monospace;
      font-size: 14px;
      padding: 6px 12px;
      margin-left: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <header>
    Species Information Editor
    <button onclick="saveContent()">üíæ Save to Public Site</button>
  </header>

  <div class="container">
    <nav>
      <strong>Sections</strong>
      <ul>
        <li><em>(Optional links)</em></li>
      </ul>
    </nav>

    <main>
      <div id="editor" class="editor" contenteditable="true" spellcheck="false">
ABBREVIATION:
EQUARV

SYNONYMS:
  Equisetum arvense var. alpestre Wahlenb.
  E. a. var. boreale (Bong.) Rupr.
  E. a. var. riparium Farw.
  E. calderi Boivin
      </div>
    </main>
  </div>

  <script>
    async function saveContent() {
      const content = document.getElementById("editor").innerText;
      const token = prompt("Enter your GitHub Personal Access Token:");

      if (!token) return alert("No token entered.");

      const filePath = "index.html";
      const repo = "fleshamalgam/taxtrees";
      const branch = "main";

      const getUrl = `https://api.github.com/repos/${repo}/contents/${filePath}`;
      const headers = {
        "Authorization": `token ${token}`,
        "Accept": "application/vnd.github.v3+json"
      };

      try {
        const getRes = await fetch(getUrl, { headers });
        const fileData = await getRes.json();
        const sha = fileData.sha;

        const newHtml = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Species Page</title>
  <style>
    body {
      margin: 0;
      font-family: "Courier New", Courier, monospace;
      background-color: #ffffff;
      color: #000;
    }
    header {
      background-color: #336633;
      color: white;
      padding: 12px 20px;
      font-size: 20px;
      font-weight: bold;
    }
    .container {
      display: flex;
    }
    nav {
      width: 220px;
      background-color: #eeeeee;
      padding: 15px;
      border-right: 1px solid #ccc;
      height: 100vh;
      box-sizing: border-box;
    }
    main {
      flex-grow: 1;
      padding: 20px;
    }
    pre.content {
      font-family: "Courier New", Courier, monospace;
      white-space: pre-wrap;
      line-height: 1.1;
      padding: 20px;
    }
  </style>
</head>
<body>
  <header>Species Information Page</header>
  <div class="container">
    <nav>
      <ul>
        <li><em>(Optional links)</em></li>
      </ul>
    </nav>
    <main>
      <pre class="content">
${content.replace(/</g, "&lt;").replace(/>/g, "&gt;")}
      </pre>
    </main>
  </div>
</body>
</html>
`;

        const updateRes = await fetch(getUrl, {
          method: "PUT",
          headers,
          body: JSON.stringify({
            message: "Update site content via edit.html",
            content: btoa(unescape(encodeURIComponent(newHtml))),
            sha: sha,
            branch: branch
          })
        });

        if (updateRes.ok) {
          alert("‚úÖ Content updated! View it at:\nhttps://fleshamalgam.github.io/taxtrees/");
        } else {
          const error = await updateRes.json();
          console.error(error);
          alert("‚ùå Error saving: " + error.message);
        }
      } catch (err) {
        console.error(err);
        alert("‚ùå Failed to fetch or update file.");
      }
    }
  </script>

</body>
</html>
