<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FEIS-style Editor</title>
  <style>
    body {
      margin: 0;
      background-color: white;
      font-family: "Courier New", Courier, monospace;
      color: black;
    }

    .toolbar {
      background-color: #336633;
      color: white;
      padding: 10px 15px;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    button {
      font-family: monospace;
      font-size: 14px;
      padding: 6px 12px;
      cursor: pointer;
    }

    #editor {
      padding: 20px;
      font-family: "Courier New", Courier, monospace;
      font-size: 14px;
      line-height: 1.2;
      white-space: pre;
      overflow: auto;
      height: calc(100vh - 50px);
      outline: none;
    }
  </style>
</head>
<body>

  <div class="toolbar">
    FEIS-style Editor
    <button onclick="saveContent()">üíæ Save to Public Site</button>
  </div>

  <pre id="editor" contenteditable="true" spellcheck="false">
<font size="+1"><b>SPECIES:</b> Equisetum arvense

<b>ABBREVIATION :</b> EQUARV

<b>SYNONYMS :</b> 
  Equisetum arvense var. alpestre Wahlenb.
  E. a. var. boreale (Bong.) Rupr.
  E. a. var. riparium Farw.
  E. calderi Boivin

<b>COMMON NAMES :</b>
  field horsetail
  common horsetail
</font>
  </pre>

  <script>
    async function saveContent() {
      const editor = document.getElementById("editor");
      const content = editor.innerText;
      const token = prompt("Enter your GitHub Personal Access Token:");

      if (!token) {
        alert("‚ùå No token entered.");
        return;
      }

      const repo = "fleshamalgam/taxtrees";
      const filePath = "index.html";
      const branch = "main";
      const apiUrl = `https://api.github.com/repos/${repo}/contents/${filePath}`;
      const headers = {
        "Authorization": `token ${token}`,
        "Accept": "application/vnd.github.v3+json"
      };

      try {
        const getRes = await fetch(apiUrl, { headers });
        const fileData = await getRes.json();
        const sha = fileData.sha;

        const htmlOutput = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FEIS Page</title>
</head>
<body bgcolor="white">
<pre><font size="+1" face="Courier New">
${content.replace(/</g, "&lt;").replace(/>/g, "&gt;")}
</font></pre>
</body>
</html>`;

        const updateRes = await fetch(apiUrl, {
          method: "PUT",
          headers,
          body: JSON.stringify({
            message: "Update FEIS-style content",
            content: btoa(unescape(encodeURIComponent(htmlOutput))),
            sha,
            branch
          })
        });

        if (updateRes.ok) {
          alert("‚úÖ Saved! View your site at:\nhttps://fleshamalgam.github.io/taxtrees/");
        } else {
          const err = await updateRes.json();
          alert("‚ùå Error saving: " + (err.message || "Unknown error"));
          console.error(err);
        }
      } catch (err) {
        console.error(err);
        alert("‚ùå Failed to update GitHub file.");
      }
    }
  </script>

</body>
</html>
